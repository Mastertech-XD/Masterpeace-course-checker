<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KUCCPS Qualification Checker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #subjectInputs {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin: 5px 0;
        }
        select {
            margin: 5px 0 15px;
        }
        button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        #results {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>KUCCPS Qualification Checker</h1>
    <form id="gradesForm">
        <div id="subjectInputs"></div>

        <label for="cluster">Select your desired cluster:</label>
        <select id="cluster" name="cluster"></select>

        <br><br>

        <button type="submit">Check Qualification</button>
    </form>

    <div id="results"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            console.log("Page loaded, initializing form...");

            // Ensure the container exists
            const subjectContainer = document.getElementById("subjectInputs");
            if (!subjectContainer) {
                console.error("Error: #subjectInputs container not found!");
                return;
            }

            // List of all KCSE subjects
            const subjects = [
                "Mathematics", "English", "Kiswahili", "Biology", "Chemistry", "Physics", "General Science",
                "History", "Geography", "CRE", "IRE", "HRE", "French", "German", "Arabic",
                "Business Studies", "Agriculture", "Home Science", "Aviation", "Computer Studies", "Music", "Art & Design"
            ];

            // List of KUCCPS clusters
            const clusters = [
                "Law", "Business & Hospitality", "Social Sciences", "Geosciences", "Engineering", "Architecture",
                "Computing & IT", "Agribusiness", "Sciences", "Mathematics", "Interior Design", "Sports Science",
                "Medicine", "History", "Agriculture & Environment", "Geography", "French & German", "Music",
                "Education", "Religious Studies"
            ];

            // KCSE grade scale
            const gradePoints = ["A", "A-", "B+", "B", "B-", "C+", "C", "C-", "D+", "D", "D-", "E"];

            // Create subject input dropdowns
            subjects.forEach(subject => {
                let label = document.createElement("label");
                label.textContent = subject + ":";

                let select = document.createElement("select");
                select.name = subject.toLowerCase().replace(/\s+/g, "_");

                gradePoints.forEach(grade => {
                    let option = document.createElement("option");
                    option.value = grade;
                    option.textContent = grade;
                    select.appendChild(option);
                });

                subjectContainer.appendChild(label);
                subjectContainer.appendChild(select);
            });

            console.log("Subjects loaded successfully.");

            // Populate cluster options
            const clusterSelect = document.getElementById("cluster");
            if (!clusterSelect) {
                console.error("Error: #cluster dropdown not found!");
                return;
            }

            clusters.forEach((cluster, index) => {
                let option = document.createElement("option");
                option.value = index + 1;
                option.textContent = cluster;
                clusterSelect.appendChild(option);
            });

            console.log("Clusters loaded successfully.");

            // Handle form submission
            document.getElementById("gradesForm").addEventListener("submit", function (e) {
                e.preventDefault();

                let formData = new FormData(this);
                let grades = {};
                formData.forEach((value, key) => {
                    grades[key] = value;
                });

                fetch("/check_qualification", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(grades)
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("results").innerHTML = `
                        <h3>Your Cluster Points: ${data.user_cluster}</h3>
                        <h4>Eligible Courses:</h4>
                        <ul>${data.qualified_courses.map(course => `<li>${course.Course} - ${course.University}</li>`).join("")}</ul>
                    `;
                })
                .catch(error => {
                    console.error("Error fetching qualification data:", error);
                    document.getElementById("results").innerHTML = "<p style='color: red;'>Failed to fetch qualification data. Please try again later.</p>";
                });
            });
        });
    </script>
</body>
</html>
